{
  "builderVersion": "",
  "schemaVersion": "1.0",
  "version": "",
  "processOwnerEmail": "",
  "lastId": 21,
  "name": "Form Created",
  "notes": "",
  "connectors": [
    {
      "from": "start",
      "to": "system_noop_v1_6",
      "label": "Has Custom Workflow",
      "value": "@form_attributes.has_key?('Custom Submission Workflow') && !@form_attributes['Custom Submission Workflow'].nil? && !@form_attributes['Custom Submission Workflow'].empty?",
      "type": "Complete"
    },
    {
      "from": "routine_kinetic_workflow_retrieve_list_v1_5",
      "to": "system_junction_v1_9",
      "label": "",
      "value": "",
      "type": "Complete"
    },
    {
      "from": "system_noop_v1_6",
      "to": "routine_kinetic_workflow_retrieve_list_v1_5",
      "label": "",
      "value": "",
      "type": "Complete"
    },
    {
      "from": "system_noop_v1_6",
      "to": "routine_kinetic_workflow_retrieve_list_v1_7",
      "label": "",
      "value": "",
      "type": "Complete"
    },
    {
      "from": "routine_kinetic_workflow_retrieve_list_v1_7",
      "to": "system_junction_v1_9",
      "label": "",
      "value": "",
      "type": "Complete"
    },
    {
      "from": "system_junction_v1_9",
      "to": "utilities_echo_v1_21",
      "label": "",
      "value": "",
      "type": "Complete"
    },
    {
      "from": "system_loop_head_v1_13",
      "to": "routine_kinetic_workflow_create_v1_14",
      "label": "",
      "value": "",
      "type": "Complete"
    },
    {
      "from": "system_loop_head_v1_13",
      "to": "system_loop_tail_v1_17",
      "label": "",
      "value": "",
      "type": "Complete"
    },
    {
      "from": "routine_kinetic_workflow_create_v1_14",
      "to": "system_loop_tail_v1_17",
      "label": "",
      "value": "",
      "type": "Complete"
    },
    {
      "from": "routine_kinetic_workflow_clone_v1_16",
      "to": "system_junction_v1_18",
      "label": "",
      "value": "",
      "type": "Complete"
    },
    {
      "from": "system_loop_tail_v1_17",
      "to": "system_junction_v1_18",
      "label": "",
      "value": "",
      "type": "Complete"
    },
    {
      "from": "system_junction_v1_18",
      "to": "routine_kinetic_finish_v1_19",
      "label": "",
      "value": "",
      "type": "Complete"
    },
    {
      "from": "utilities_echo_v1_21",
      "to": "system_loop_head_v1_13",
      "label": "New Trees",
      "value": "JSON.parse(@results['Trees Needed']['output'])['new'].size > 0",
      "type": "Complete"
    },
    {
      "from": "utilities_echo_v1_21",
      "to": "routine_kinetic_workflow_clone_v1_16",
      "label": "Clone Trees",
      "value": "JSON.parse(@results['Trees Needed']['output'])['clone'].size > 0",
      "type": "Complete"
    }
  ],
  "nodes": [
    {
      "definitionId": "system_start_v1",
      "id": "start",
      "name": "Start",
      "position": {
        "x": 550.0,
        "y": -55.0
      },
      "version": 1,
      "configured": true,
      "defers": false,
      "deferrable": false,
      "visible": false,
      "parameters": [

      ],
      "messages": [

      ]
    },
    {
      "definitionId": "routine_kinetic_workflow_retrieve_list_v1",
      "id": "routine_kinetic_workflow_retrieve_list_v1_5",
      "name": "Retrieve Existing Form Workflow",
      "position": {
        "x": 396.0,
        "y": 185.0
      },
      "version": 1,
      "configured": true,
      "defers": true,
      "deferrable": true,
      "visible": false,
      "parameters": [
        {
          "id": "Source",
          "description": "Name of the source to retrieve workflow processes for",
          "label": "Source",
          "menu": "",
          "dependsOnId": "",
          "dependsOnValue": "",
          "required": true,
          "value": "<%=@source['Name']%>"
        },
        {
          "id": "Group",
          "description": "Name of the source group to retrieve workflow processes for",
          "label": "Group",
          "menu": "",
          "dependsOnId": "",
          "dependsOnValue": "",
          "required": true,
          "value": "<%=\"Submissions > #{@kapp['Slug']} > #{@form['Slug']}\"%>"
        },
        {
          "id": "Names",
          "description": "Names of workflow processes to retrieve (comma-separated, leave blank to retrieve all workflow processes)",
          "label": "Names",
          "menu": "",
          "dependsOnId": "",
          "dependsOnValue": "",
          "required": false,
          "value": ""
        },
        {
          "id": "Limit",
          "description": "Maximum number of workflow processes to return (default 1000)",
          "label": "Limit",
          "menu": "",
          "dependsOnId": "",
          "dependsOnValue": "",
          "required": false,
          "value": ""
        },
        {
          "id": "Offset",
          "description": "The offset to start if there are more results than the specified limit (default 0)",
          "label": "Offset",
          "menu": "",
          "dependsOnId": "",
          "dependsOnValue": "",
          "required": false,
          "value": ""
        }
      ],
      "messages": [

      ]
    },
    {
      "definitionId": "system_noop_v1",
      "id": "system_noop_v1_6",
      "name": "Has Custom Workflow",
      "position": {
        "x": 550.0,
        "y": 82.0
      },
      "version": 1,
      "configured": true,
      "defers": false,
      "deferrable": false,
      "visible": false,
      "parameters": [

      ],
      "messages": [

      ]
    },
    {
      "definitionId": "routine_kinetic_workflow_retrieve_list_v1",
      "id": "routine_kinetic_workflow_retrieve_list_v1_7",
      "name": "Retrieve Kapp Workflow",
      "position": {
        "x": 671.0,
        "y": 198.0
      },
      "version": 1,
      "configured": true,
      "defers": true,
      "deferrable": true,
      "visible": false,
      "parameters": [
        {
          "id": "Source",
          "description": "Name of the source to retrieve workflow processes for",
          "label": "Source",
          "menu": "",
          "dependsOnId": "",
          "dependsOnValue": "",
          "required": true,
          "value": "<%=@source['Name']%>"
        },
        {
          "id": "Group",
          "description": "Name of the source group to retrieve workflow processes for",
          "label": "Group",
          "menu": "",
          "dependsOnId": "",
          "dependsOnValue": "",
          "required": true,
          "value": "<%=\"Submissions > #{@kapp['Slug']}\"%>"
        },
        {
          "id": "Names",
          "description": "Names of workflow processes to retrieve (comma-separated, leave blank to retrieve all workflow processes)",
          "label": "Names",
          "menu": "",
          "dependsOnId": "",
          "dependsOnValue": "",
          "required": false,
          "value": ""
        },
        {
          "id": "Limit",
          "description": "Maximum number of workflow processes to return (default 1000)",
          "label": "Limit",
          "menu": "",
          "dependsOnId": "",
          "dependsOnValue": "",
          "required": false,
          "value": ""
        },
        {
          "id": "Offset",
          "description": "The offset to start if there are more results than the specified limit (default 0)",
          "label": "Offset",
          "menu": "",
          "dependsOnId": "",
          "dependsOnValue": "",
          "required": false,
          "value": ""
        }
      ],
      "messages": [

      ]
    },
    {
      "definitionId": "system_junction_v1",
      "id": "system_junction_v1_9",
      "name": "Lookups - Continue",
      "position": {
        "x": 529.0,
        "y": 286.0
      },
      "version": 1,
      "configured": true,
      "defers": false,
      "deferrable": false,
      "visible": false,
      "parameters": [

      ],
      "messages": [

      ]
    },
    {
      "definitionId": "system_loop_head_v1",
      "id": "system_loop_head_v1_13",
      "name": "Create Trees - Head",
      "position": {
        "x": 385.0,
        "y": 407.0
      },
      "version": 1,
      "configured": true,
      "defers": false,
      "deferrable": false,
      "visible": false,
      "parameters": [
        {
          "id": "data_source",
          "description": "The source that contains the data to use to create each task in the loop.",
          "label": "Data Source:",
          "menu": "",
          "dependsOnId": "",
          "dependsOnValue": "",
          "required": true,
          "value": "<%=\nneeded_workflows = JSON.parse(@results['Trees Needed']['output'])['new']\ntrees_xml = \"<trees>\\n\"\ntrees_xml << needed_workflows.collect{|name| \"\\t<tree>#{name}</tree>\\n\"}.to_s\ntrees_xml << \"</trees>\"\ntrees_xml%>"
        },
        {
          "id": "loop_path",
          "description": "The XPath statement to indicate what data records to process.",
          "label": "Loop Path:",
          "menu": "",
          "dependsOnId": "",
          "dependsOnValue": "",
          "required": true,
          "value": "//trees/tree"
        },
        {
          "id": "var_name",
          "description": "The local variable name used to represent the data used in loop tasks.",
          "label": "Variable Name:",
          "menu": "",
          "dependsOnId": "",
          "dependsOnValue": "",
          "required": false,
          "value": ""
        }
      ],
      "messages": [

      ]
    },
    {
      "definitionId": "routine_kinetic_workflow_create_v1",
      "id": "routine_kinetic_workflow_create_v1_14",
      "name": "Create New Tree",
      "position": {
        "x": 245.0,
        "y": 528.0
      },
      "version": 1,
      "configured": true,
      "defers": true,
      "deferrable": true,
      "visible": false,
      "parameters": [
        {
          "id": "Structure",
          "description": "The workflow XML document. This is the content of the tree/routine export file.",
          "label": "Structure",
          "menu": "",
          "dependsOnId": "",
          "dependsOnValue": "",
          "required": true,
          "value": "<tree schema_version=\"1.0\">\n  <sourceName>Source Name</sourceName>\n  <sourceGroup>Source Group</sourceGroup>\n  <type>Tree</type>\n  <status>Active</status>\n  <taskTree schema_version=\"1.0\" version=\"\" builder_version=\"\">\n    <name>Name</name>\n    <author/>\n    <notes/>\n    <lastID>1</lastID>\n    <request>\n      <task definition_id=\"system_start_v1\" id=\"start\" name=\"Start\" x=\"31\" y=\"31\">\n        <version>1</version>\n        <configured>true</configured>\n        <defers>false</defers>\n        <deferrable>false</deferrable>\n        <visible>false</visible>\n        <parameters/>\n        <messages/>\n        <dependents>\n          <task type=\"Complete\" label=\"\" value=\"\">routine_kinetic_finish_v1_1</task>\n        </dependents>\n      </task>\n\n      <task name=\"Finish\" id=\"routine_kinetic_finish_v1_1\" definition_id=\"routine_kinetic_finish_v1\" x=\"319\" y=\"22\">\n        <version>1</version>\n        <configured>true</configured>\n        <defers>false</defers>\n        <deferrable>true</deferrable>\n        <visible>false</visible>\n        <parameters>\n          <parameter id=\"Run Id\" label=\"Run Id\" required=\"false\" tooltip=\"The Id of the completed run\" menu=\"\">&lt;%=@run['Id']%&gt;</parameter>\n        </parameters>\n        <messages>\n          <message type=\"Create\"/>\n          <message type=\"Update\"/>\n          <message type=\"Complete\"/>\n        </messages>\n        <dependents/>\n      </task>\n    </request>\n  </taskTree>\n</tree>"
        },
        {
          "id": "Source",
          "description": "Override to the value set in structure. Use '-' for a global routine.",
          "label": "Source",
          "menu": "",
          "dependsOnId": "",
          "dependsOnValue": "",
          "required": false,
          "value": "<%=@source['Name']%>"
        },
        {
          "id": "Group",
          "description": "Override to the value set in structure. Use '-' for any routine.",
          "label": "Group",
          "menu": "",
          "dependsOnId": "",
          "dependsOnValue": "",
          "required": false,
          "value": "<%=\"Submissions > #{@kapp['Slug']} > #{@form['Slug']}\"%>"
        },
        {
          "id": "Name",
          "description": "Override to the value set in the structure. The workflow (tree/routine) name.",
          "label": "Name",
          "menu": "",
          "dependsOnId": "",
          "dependsOnValue": "",
          "required": false,
          "value": "<%=@results['Create Trees - Head']['Value'].capitalize%>"
        },
        {
          "id": "Definition Id",
          "description": "Override to the value set in the structure.",
          "label": "Definition Id",
          "menu": "",
          "dependsOnId": "",
          "dependsOnValue": "",
          "required": false,
          "value": ""
        },
        {
          "id": "Notes",
          "description": "Override to the value set in the structure.",
          "label": "Notes",
          "menu": "",
          "dependsOnId": "",
          "dependsOnValue": "",
          "required": false,
          "value": ""
        },
        {
          "id": "Owner Email",
          "description": "Override to the value set in the structure.",
          "label": "Owner Email",
          "menu": "",
          "dependsOnId": "",
          "dependsOnValue": "",
          "required": false,
          "value": ""
        },
        {
          "id": "Status",
          "description": "Override to the value set in the structure.",
          "label": "Status",
          "menu": "",
          "dependsOnId": "",
          "dependsOnValue": "",
          "required": false,
          "value": "Active"
        },
        {
          "id": "Type",
          "description": "Override to the value set in the structure.",
          "label": "Type",
          "menu": "",
          "dependsOnId": "",
          "dependsOnValue": "",
          "required": false,
          "value": "Tree"
        }
      ],
      "messages": [

      ]
    },
    {
      "definitionId": "routine_kinetic_workflow_clone_v1",
      "id": "routine_kinetic_workflow_clone_v1_16",
      "name": "Clone Kapp Tree",
      "position": {
        "x": 693.0,
        "y": 429.0
      },
      "version": 1,
      "configured": true,
      "defers": true,
      "deferrable": true,
      "visible": false,
      "parameters": [
        {
          "id": "From - Source",
          "description": "The source to clone the workflow(s) from. Use '-' for a global routine.",
          "label": "From - Source",
          "menu": "",
          "dependsOnId": "",
          "dependsOnValue": "",
          "required": true,
          "value": "<%=@source['Name']%>"
        },
        {
          "id": "From - Group",
          "description": "The source group to clone the workflow(s) from. Use '-' for any routine.",
          "label": "From - Group",
          "menu": "",
          "dependsOnId": "",
          "dependsOnValue": "",
          "required": true,
          "value": "<%=\"Submissions > #{@kapp['Slug']}\"%>"
        },
        {
          "id": "From - Names JSON",
          "description": "A JSON list of the workflow (tree/routine) names to clone. (ie. [\"Created\", \"Submitted\"]).",
          "label": "From - Names JSON",
          "menu": "",
          "dependsOnId": "",
          "dependsOnValue": "",
          "required": true,
          "value": "<%=JSON.parse(@results['Trees Needed']['output'])['clone'].to_json%>"
        },
        {
          "id": "From - Local Routines JSON",
          "description": "A JSON list of the local routines clone. (ie. [\"My Local Routine\"]).",
          "label": "From - Local Routines JSON",
          "menu": "",
          "dependsOnId": "",
          "dependsOnValue": "",
          "required": false,
          "value": ""
        },
        {
          "id": "To - Source",
          "description": "The source to clone the workflow(s) to. Use '-' for a global routine.",
          "label": "To - Source",
          "menu": "",
          "dependsOnId": "",
          "dependsOnValue": "",
          "required": true,
          "value": "<%=@source['Name']%>"
        },
        {
          "id": "To - Group",
          "description": "The source group to clone the workflow(s) to. Use '-' for any routine.",
          "label": "To - Group",
          "menu": "",
          "dependsOnId": "",
          "dependsOnValue": "",
          "required": true,
          "value": "<%=\"Submissions > #{@kapp['Slug']} > #{@form['Slug']}\"%>"
        }
      ],
      "messages": [

      ]
    },
    {
      "definitionId": "system_loop_tail_v1",
      "id": "system_loop_tail_v1_17",
      "name": "Create Trees - Tail",
      "position": {
        "x": 386.0,
        "y": 528.0
      },
      "version": 1,
      "configured": true,
      "defers": false,
      "deferrable": false,
      "visible": false,
      "parameters": [
        {
          "id": "type",
          "description": "How many loop processes must be completed before continuing?",
          "label": "Type:",
          "menu": "All,Some,Any",
          "dependsOnId": "",
          "dependsOnValue": "",
          "required": true,
          "value": "All"
        },
        {
          "id": "number",
          "description": "If some, how many?",
          "label": "Number:",
          "menu": "",
          "dependsOnId": "type",
          "dependsOnValue": "Some",
          "required": false,
          "value": ""
        }
      ],
      "messages": [

      ]
    },
    {
      "definitionId": "system_junction_v1",
      "id": "system_junction_v1_18",
      "name": "Trees Created - Continue",
      "position": {
        "x": 694.0,
        "y": 519.0
      },
      "version": 1,
      "configured": true,
      "defers": false,
      "deferrable": false,
      "visible": false,
      "parameters": [

      ],
      "messages": [

      ]
    },
    {
      "definitionId": "routine_kinetic_finish_v1",
      "id": "routine_kinetic_finish_v1_19",
      "name": "Finish",
      "position": {
        "x": 829.0,
        "y": 530.0
      },
      "version": 1,
      "configured": true,
      "defers": false,
      "deferrable": true,
      "visible": false,
      "parameters": [
        {
          "id": "Run Id",
          "description": "The Id of the completed run",
          "label": "Run Id",
          "menu": "",
          "dependsOnId": "",
          "dependsOnValue": "",
          "required": false,
          "value": "<%=@run['Id']%>"
        }
      ],
      "messages": [

      ]
    },
    {
      "definitionId": "utilities_echo_v1",
      "id": "utilities_echo_v1_21",
      "name": "Trees Needed",
      "position": {
        "x": 530.0,
        "y": 381.0
      },
      "version": 1,
      "configured": true,
      "defers": false,
      "deferrable": false,
      "visible": true,
      "parameters": [
        {
          "id": "input",
          "description": "",
          "label": "Input",
          "menu": "",
          "dependsOnId": "",
          "dependsOnValue": "",
          "required": true,
          "value": "<%=\nexisting_form_workflows = JSON.parse(@results['Retrieve Existing Form Workflow']['Workflow List JSON']).collect{|tree| tree['name']}\nkapp_workflows = JSON.parse(@results['Retrieve Kapp Workflow']['Workflow List JSON']).collect{|tree| tree['name']}\nrequired_workflows = @form_attributes['Custom Submission Workflow']\nclone = required_workflows.select{|name| !existing_form_workflows.include?(name) && kapp_workflows.include?(name)}\nnew = required_workflows.select{|name| !existing_form_workflows.include?(name) && !kapp_workflows.include?(name)}\n{\n  'clone' => clone,\n  'new' => new\n}.to_json%>"
        }
      ],
      "messages": [

      ]
    }
  ]
}