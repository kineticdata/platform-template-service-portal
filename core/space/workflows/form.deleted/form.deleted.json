{
  "builderVersion": "",
  "schemaVersion": "1.0",
  "version": "",
  "processOwnerEmail": "",
  "lastId": 26,
  "name": "Form Deleted",
  "notes": "",
  "connectors": [
    {
      "from": "start",
      "to": "system_noop_v1_6",
      "label": "Has Custom Workflow",
      "value": "!@form_attributes['Custom Submission Workflow'].nil? && !@form_attributes['Custom Submission Workflow'].empty?",
      "type": "Complete"
    },
    {
      "from": "routine_kinetic_workflow_retrieve_list_v1_5",
      "to": "utilities_echo_v1_21",
      "label": "",
      "value": "",
      "type": "Complete"
    },
    {
      "from": "system_noop_v1_6",
      "to": "routine_kinetic_workflow_retrieve_list_v1_5",
      "label": "",
      "value": "",
      "type": "Complete"
    },
    {
      "from": "utilities_echo_v1_21",
      "to": "system_loop_head_v1_22",
      "label": "Delete Trees",
      "value": "JSON.parse(@results['Trees Needed']['output'])['delete'].size > 0",
      "type": "Complete"
    },
    {
      "from": "system_loop_head_v1_22",
      "to": "system_loop_tail_v1_23",
      "label": "",
      "value": "",
      "type": "Complete"
    },
    {
      "from": "system_loop_head_v1_22",
      "to": "routine_kinetic_workflow_delete_v1_26",
      "label": "",
      "value": "",
      "type": "Complete"
    },
    {
      "from": "system_loop_tail_v1_23",
      "to": "routine_kinetic_finish_v1_19",
      "label": "",
      "value": "",
      "type": "Complete"
    },
    {
      "from": "routine_kinetic_workflow_delete_v1_26",
      "to": "system_loop_tail_v1_23",
      "label": "",
      "value": "",
      "type": "Complete"
    }
  ],
  "nodes": [
    {
      "definitionId": "system_start_v1",
      "id": "start",
      "name": "Start",
      "position": {
        "x": 550.0,
        "y": -35.0
      },
      "version": 1,
      "configured": true,
      "defers": false,
      "deferrable": false,
      "visible": false,
      "parameters": [

      ],
      "messages": [

      ]
    },
    {
      "definitionId": "routine_kinetic_workflow_retrieve_list_v1",
      "id": "routine_kinetic_workflow_retrieve_list_v1_5",
      "name": "Retrieve Existing Form Workflow",
      "position": {
        "x": 548.0,
        "y": 193.0
      },
      "version": 1,
      "configured": true,
      "defers": true,
      "deferrable": true,
      "visible": false,
      "parameters": [
        {
          "id": "Source",
          "description": "Name of the source to retrieve workflow processes for",
          "label": "Source",
          "menu": "",
          "dependsOnId": "",
          "dependsOnValue": "",
          "required": true,
          "value": "<%=@source['Name']%>"
        },
        {
          "id": "Group",
          "description": "Name of the source group to retrieve workflow processes for",
          "label": "Group",
          "menu": "",
          "dependsOnId": "",
          "dependsOnValue": "",
          "required": true,
          "value": "<%=\"Submissions > #{@kapp['Slug']} > #{@form['Slug']}\"%>"
        },
        {
          "id": "Names",
          "description": "Names of workflow processes to retrieve (comma-separated, leave blank to retrieve all workflow processes)",
          "label": "Names",
          "menu": "",
          "dependsOnId": "",
          "dependsOnValue": "",
          "required": false,
          "value": ""
        },
        {
          "id": "Limit",
          "description": "Maximum number of workflow processes to return (default 1000)",
          "label": "Limit",
          "menu": "",
          "dependsOnId": "",
          "dependsOnValue": "",
          "required": false,
          "value": ""
        },
        {
          "id": "Offset",
          "description": "The offset to start if there are more results than the specified limit (default 0)",
          "label": "Offset",
          "menu": "",
          "dependsOnId": "",
          "dependsOnValue": "",
          "required": false,
          "value": ""
        }
      ],
      "messages": [

      ]
    },
    {
      "definitionId": "system_noop_v1",
      "id": "system_noop_v1_6",
      "name": "Has Custom Workflow",
      "position": {
        "x": 550.0,
        "y": 82.0
      },
      "version": 1,
      "configured": true,
      "defers": false,
      "deferrable": false,
      "visible": false,
      "parameters": [

      ],
      "messages": [

      ]
    },
    {
      "definitionId": "routine_kinetic_finish_v1",
      "id": "routine_kinetic_finish_v1_19",
      "name": "Finish",
      "position": {
        "x": 399.0,
        "y": 641.0
      },
      "version": 1,
      "configured": true,
      "defers": false,
      "deferrable": true,
      "visible": false,
      "parameters": [
        {
          "id": "Run Id",
          "description": "The Id of the completed run",
          "label": "Run Id",
          "menu": "",
          "dependsOnId": "",
          "dependsOnValue": "",
          "required": false,
          "value": "<%=@run['Id']%>"
        }
      ],
      "messages": [

      ]
    },
    {
      "definitionId": "utilities_echo_v1",
      "id": "utilities_echo_v1_21",
      "name": "Trees Needed",
      "position": {
        "x": 549.0,
        "y": 341.0
      },
      "version": 1,
      "configured": true,
      "defers": false,
      "deferrable": false,
      "visible": true,
      "parameters": [
        {
          "id": "input",
          "description": "",
          "label": "Input",
          "menu": "",
          "dependsOnId": "",
          "dependsOnValue": "",
          "required": true,
          "value": "<%=\nexisting_form_workflows = JSON.parse(@results['Retrieve Existing Form Workflow']['Workflow List JSON']).collect{|tree| tree['name']}\nrequired_workflows = @form_attributes['Custom Submission Workflow']\ndelete = existing_form_workflows\n{\n  'delete' => delete\n}.to_json%>"
        }
      ],
      "messages": [

      ]
    },
    {
      "definitionId": "system_loop_head_v1",
      "id": "system_loop_head_v1_22",
      "name": "Delete Trees - Head",
      "position": {
        "x": 419.0,
        "y": 419.0
      },
      "version": 1,
      "configured": true,
      "defers": false,
      "deferrable": false,
      "visible": false,
      "parameters": [
        {
          "id": "data_source",
          "description": "The source that contains the data to use to create each task in the loop.",
          "label": "Data Source:",
          "menu": "",
          "dependsOnId": "",
          "dependsOnValue": "",
          "required": true,
          "value": "<%=\nneeded_workflows = JSON.parse(@results['Trees Needed']['output'])['delete']\ntrees_xml = \"<trees>\\n\"\ntrees_xml << needed_workflows.collect{|name| \"\\t<tree>#{name}</tree>\\n\"}.to_s\ntrees_xml << \"</trees>\"\ntrees_xml%>"
        },
        {
          "id": "loop_path",
          "description": "The XPath statement to indicate what data records to process.",
          "label": "Loop Path:",
          "menu": "",
          "dependsOnId": "",
          "dependsOnValue": "",
          "required": true,
          "value": "//trees/tree"
        },
        {
          "id": "var_name",
          "description": "The local variable name used to represent the data used in loop tasks.",
          "label": "Variable Name:",
          "menu": "",
          "dependsOnId": "",
          "dependsOnValue": "",
          "required": false,
          "value": ""
        }
      ],
      "messages": [

      ]
    },
    {
      "definitionId": "system_loop_tail_v1",
      "id": "system_loop_tail_v1_23",
      "name": "Delete Trees - Tail",
      "position": {
        "x": 397.0,
        "y": 541.0
      },
      "version": 1,
      "configured": true,
      "defers": false,
      "deferrable": false,
      "visible": false,
      "parameters": [
        {
          "id": "type",
          "description": "How many loop processes must be completed before continuing?",
          "label": "Type:",
          "menu": "All,Some,Any",
          "dependsOnId": "",
          "dependsOnValue": "",
          "required": true,
          "value": "All"
        },
        {
          "id": "number",
          "description": "If some, how many?",
          "label": "Number:",
          "menu": "",
          "dependsOnId": "type",
          "dependsOnValue": "Some",
          "required": false,
          "value": ""
        }
      ],
      "messages": [

      ]
    },
    {
      "definitionId": "routine_kinetic_workflow_delete_v1",
      "id": "routine_kinetic_workflow_delete_v1_26",
      "name": "Delete Tree",
      "position": {
        "x": 644.0,
        "y": 515.0
      },
      "version": 1,
      "configured": true,
      "defers": true,
      "deferrable": true,
      "visible": false,
      "parameters": [
        {
          "id": "Title",
          "description": "The title of the workflow (tree / routine) which is a concatenation of \nthe source name :: source group :: workflow name",
          "label": "Title",
          "menu": "",
          "dependsOnId": "",
          "dependsOnValue": "",
          "required": true,
          "value": "<%=\"#{@source['Name']} :: Submissions > #{@kapp['Slug']} > #{@form['Slug']} :: #{@results['Delete Trees - Head']['Value'].capitalize}\"%>"
        }
      ],
      "messages": [

      ]
    }
  ]
}